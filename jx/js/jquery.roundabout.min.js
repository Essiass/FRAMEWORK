/*////////////////////////////////////////////////////////////////////////////////////////////////////////
///// Code RE-mixed by Molokoloco ..... 2011 ......... [EVER IN PROGRESS (it's not done yet)]
////  Sources : https://github.com/molokoloco/
//////////////////////////////////////////////////////////////////////////////////////////////////// */

/**
 * jQuery Roundabout - v1.1
 * http://fredhq.com/projects/roundabout/
 *
 * Moves list-items of enabled ordered and unordered lists long
 * a chosen path. Includes the default "lazySusan" path, that
 * moves items long a spinning turntable.
 *
 * Terms of Use // jQuery Roundabout
 * 
 * Open source under the BSD license
 *
 * Copyright (c) 2010, Fred LeBlanc
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without 
 * modification, are permitted provided that the following conditions are met:
 * 
 *   - Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 *   - Redistributions in binary form must reproduce the above 
 *     copyright notice, this list of conditions and the following 
 *     disclaimer in the documentation and/or other materials provided 
 *     with the distribution.
 *   - Neither the name of the author nor the names of its contributors 
 *     may be used to endorse or promote products derived from this 
 *     software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" 
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE 
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR 
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS 
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) 
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE 
 * POSSIBILITY OF SUCH DAMAGE.
 */

$(function(){$.extend({roundabout_shape:{def:"juju",juju:function(b,c,a){return{x:Math.sin(b+c),y:a-Math.cos(b)*a,z:(Math.cos(b+c)+1)/2,scale:Math.sin(b+Math.PI/2+c)/2+0.5}}}});$.fn.roundabout=function(b,c){var a=typeof b!="object"?{}:b,a={bearing:typeof a.bearing=="undefined"?0:$.roundabout_toFloat(a.bearing%360),tilt:typeof a.tilt=="undefined"?0:$.roundabout_toFloat(a.tilt),minZ:typeof a.minZ=="undefined"?100:parseInt(a.minZ,10),maxZ:typeof a.maxZ=="undefined"?400:parseInt(a.maxZ,10),minOpacity:typeof a.minOpacity== "undefined"?0:$.roundabout_toFloat(a.minOpacity),maxOpacity:typeof a.maxOpacity=="undefined"?1:$.roundabout_toFloat(a.maxOpacity),minScale:typeof a.minScale=="undefined"?0.4:$.roundabout_toFloat(a.minScale),maxScale:typeof a.maxScale=="undefined"?1:$.roundabout_toFloat(a.maxScale),duration:typeof a.duration=="undefined"?600:parseInt(a.duration,10),btnNext:a.btnNext||null,btnPrev:a.btnPrev||null,easing:a.easing||"swing",clickToFocus:a.clickToFocus!==!1,focusBearing:!a.focusBearing?0:$.roundabout_toFloat(a.focusBearing% 360),shape:a.shape||"juju",debug:a.debug||!1,childSelector:a.childSelector||"li",startingChild:typeof a.startingChild=="undefined"?null:parseInt(a.startingChild,10),reflect:typeof a.reflect=="undefined"||a.reflect===!1?!1:!0};this.each(function(){var b=$(this),c=$.roundabout_toFloat(360/b.children(a.childSelector).length),d=a.startingChild===null?a.bearing:a.startingChild*c;b.addClass("roundabout-holder").css({padding:0,position:"relative","z-index":a.minZ});b.data("roundabout",{bearing:d,tilt:a.tilt, minZ:a.minZ,maxZ:a.maxZ,minOpacity:a.minOpacity,maxOpacity:a.maxOpacity,minScale:a.minScale,maxScale:a.maxScale,duration:a.duration,easing:a.easing,clickToFocus:a.clickToFocus,focusBearing:a.focusBearing,animating:0,childInFocus:-1,shape:a.shape,period:c,debug:a.debug,childSelector:a.childSelector,numChild:b.children(a.childSelector).length,reflect:a.reflect});a.clickToFocus===!0&&b.children(a.childSelector).css({"transform-origin":"0 0","-ms-transform-origin":"0 0","-webkit-transform-origin":"0 0", "-moz-transform-origin":"0 0","-o-transform-origin":"0 0"}).each(function(d){$(this).click(function(j){var h=a.reflect===!0?360-c*d:c*d,h=$.roundabout_toFloat(h);if(!$.roundabout_isInFocus(b,h))return j.preventDefault(),b.data("roundabout").animating===0&&b.roundabout_animateAngleToFocus(h),!1})});$.roundabout_goNext=function(){b.data("roundabout").animating===0&&b.roundabout_animateToNextChild()};a.btnNext&&$(a.btnNext).bind("click.roundabout",function(a){a.preventDefault();$.roundabout_goNext(); return!1});$.roundabout_goPrev=function(){b.data("roundabout").animating===0&&b.roundabout_animateToPreviousChild()};a.btnPrev&&$(a.btnPrev).bind("click.roundabout",function(a){a.preventDefault();$.roundabout_goPrev();return!1})});this.roundabout_startChildren();if(typeof c==="function"){var d=this;setTimeout(function(){c(d)},0)}return this};$.fn.roundabout_startChildren=function(){this.each(function(){var b=$(this),c=b.data("roundabout");b.children(c.childSelector).each(function(a){var b=c.reflect=== !0?360-c.period*a:c.period*a;$(this).addClass("roundabout-moveable-item").css("position","absolute").prepend('<p class="paginate">-'+(a+1)+"-</p>");$(this).data("roundabout",{startWidth:$(this).width(),startHeight:$(this).height(),degrees:b})});b.roundabout_updateChildPositions()});return this};$.fn.roundabout_setTilt=function(b,c){this.each(function(){$(this).data("roundabout").tilt=b;$(this).roundabout_updateChildPositions()});if(typeof c==="function"){var a=this;setTimeout(function(){c(a)},0)}return this}; $.fn.roundabout_setBearing=function(b,c){this.each(function(){$(this).data("roundabout").bearing=$.roundabout_toFloat(b%360,2);$(this).roundabout_updateChildPositions()});if(typeof c==="function"){var a=this;setTimeout(function(){c(a)},0)}return this};$.fn.roundabout_adjustBearing=function(b,c){b=$.roundabout_toFloat(b);b!==0&&this.each(function(){$(this).data("roundabout").bearing=$.roundabout_getBearing($(this))+b;$(this).roundabout_updateChildPositions()});if(typeof c==="function"){var a=this; setTimeout(function(){c(a)},0)}return this};$.fn.roundabout_adjustTilt=function(b,c){b=$.roundabout_toFloat(b);b!==0&&this.each(function(){$(this).data("roundabout").tilt=$.roundabout_toFloat($(this).roundabout_get("tilt")+b);$(this).roundabout_updateChildPositions()});if(typeof c==="function"){var a=this;setTimeout(function(){c(a)},0)}return this};$.fn.roundabout_animateToBearing=function(b,c,a,d){var b=$.roundabout_toFloat(b),g=new Date,e=typeof c=="undefined"?null:c,i=typeof a=="undefined"?null: a,f=typeof d!=="object"?null:d;this.each(function(){var a=$(this),c=a.data("roundabout"),d,k=e===null?c.duration:e,l=i!==null?i:c.easing||"swing";f===null&&(f={timerStart:g,start:$.roundabout_getBearing(a),totalTime:k});d=g-f.timerStart;d<k?(c.animating=1,typeof $.easing.def=="string"?(c=$.easing[l]||$.easing[$.easing.def],d=c(null,d,f.start,b-f.start,f.totalTime)):d=$.easing[l](d/f.totalTime,d,f.start,b-f.start,f.totalTime),a.roundabout_setBearing(d,function(){a.roundabout_animateToBearing(b,k,l, f)})):(b=b<0?b+360:b%360,c.animating=0,a.roundabout_setBearing(b))});return this};$.fn.roundabout_animateToDelta=function(b,c,a){this.each(function(){b=$.roundabout_getBearing($(this))+$.roundabout_toFloat(b);$(this).roundabout_animateToBearing(b,c,a)});return this};$.fn.roundabout_animateToChild=function(b,c,a){this.each(function(){var d=$(this),g=d.data("roundabout");g.childInFocus!==b&&g.animating===0&&(g=$(d.children(g.childSelector)[b]),d.roundabout_animateAngleToFocus(g.data("roundabout").degrees, c,a))});return this};$.fn.roundabout_animateToNearbyChild=function(b,c){var a=b[0],d=b[1];this.each(function(){var b=$(this).data("roundabout"),e=$.roundabout_toFloat(360-$.roundabout_getBearing($(this))),i=b.period,f=0,j=b.reflect,h=$(this).children(b.childSelector).length,e=j===!0?e%360:e;if(b.animating===0)if(j===!1&&c==="next"||j===!0&&c!=="next")for(e=e===0?360:e;f<h;){b={lower:$.roundabout_toFloat(i*f),upper:$.roundabout_toFloat(i*(f+1))};b.upper=f==h-1?360:b.upper;if(e<=b.upper&&e>b.lower){$(this).roundabout_animateToDelta(e- b.lower,a,d);break}f++}else for(;;){b={lower:$.roundabout_toFloat(i*f),upper:$.roundabout_toFloat(i*(f+1))};b.upper=f==h-1?360:b.upper;if(e>=b.lower&&e<b.upper){$(this).roundabout_animateToDelta(e-b.upper,a,d);break}f++}});return this};$.fn.roundabout_animateToNextChild=function(){return this.roundabout_animateToNearbyChild(arguments,"next")};$.fn.roundabout_animateToPreviousChild=function(){return this.roundabout_animateToNearbyChild(arguments,"previous")};$.fn.roundabout_animateAngleToFocus=function(b, c,a){this.each(function(){var d=$.roundabout_getBearing($(this))-b,d=Math.abs(360-d)<Math.abs(0-d)?360-d:0-d,d=d>180?-(360-d):d;d!==0&&$(this).roundabout_animateToDelta(d,c,a)});return this};$.fn.roundabout_updateChildPositions=function(){this.each(function(){var b=$(this),c=b.data("roundabout"),a=-1,d={bearing:$.roundabout_getBearing(b),tilt:c.tilt,stage:{width:Math.floor(b.width()*0.9),height:Math.floor(b.height()*0.9)},animating:c.animating,inFocus:c.childInFocus,focusBearingRad:$.roundabout_degToRad(c.focusBearing), shape:$.roundabout_shape[c.shape]||$.roundabout_shape[$.roundabout_shape.def]};d.midStage={width:d.stage.width/2,height:d.stage.height/2};d.nudge={width:d.midStage.width+d.stage.width*0.05,height:d.midStage.height+d.stage.height*0.05};d.zValues={min:c.minZ,max:c.maxZ,diff:c.maxZ-c.minZ};d.opacity={min:c.minOpacity,max:c.maxOpacity,diff:c.maxOpacity-c.minOpacity};d.scale={min:c.minScale,max:c.maxScale,diff:c.maxScale-c.minScale};b.children(c.childSelector).each(function(c){$.roundabout_updateChildPosition($(this), b,d,c)&&d.animating===0?(a=c,b.trigger("roundaboutFocus",[{childPos:c}]),$(this).addClass("roundabout-in-focus")):$(this).removeClass("roundabout-in-focus")});if(a!==d.inFocus)$.roundabout_triggerEvent(b,d.inFocus,"blur"),a!==-1&&$.roundabout_triggerEvent(b,a,"focus"),c.childInFocus=a});return this};$.roundabout_getBearing=function(b){return $.roundabout_toFloat(b.data("roundabout").bearing)%360};$.roundabout_degToRad=function(b){return b%360*Math.PI/180};$.roundabout_isInFocus=function(b,c){return $.roundabout_getBearing(b)% 360===c%360};$.roundabout_triggerEvent=function(b,c,a){return c<0?this:$(b.children(b.data("roundabout").childSelector)[c]).trigger(a)};$.roundabout_toFloat=function(b){b=Math.round(parseFloat(b)*1E3)/1E3;return parseFloat(b.toFixed(2))};$.roundabout_updateChildPosition=function(b,c,a){for(var b=$(b),d=b.data("roundabout"),g=c.data("roundabout"),e=$.roundabout_degToRad(360-d.degrees+a.bearing);e<0;)e+=Math.PI*2;for(;e>Math.PI*2;)e-=Math.PI*2;e=a.shape(e,a.focusBearingRad,a.tilt);e.scale=e.scale>1? 1:e.scale;e.adjustedScale=(a.scale.min+a.scale.diff*e.scale).toFixed(4);e.width=(e.adjustedScale*d.startWidth).toFixed(4);e.height=(e.adjustedScale*d.startHeight).toFixed(4);e.left=(e.x*a.midStage.width+a.nudge.width-e.width/2).toFixed(1)+"px";e.top=(e.y*a.midStage.height+a.nudge.height-e.height/2).toFixed(1)+"px";e.opacity=(a.opacity.min+a.opacity.diff*e.scale).toFixed(2);e.z=Math.round(a.zValues.min+a.zValues.diff*e.z);g.numChild>7&&(e.opacity<0.6||e.z<0.6)?b.find("div:first").hide():b.find("div:first").show(); b.css({transform:"translate("+e.left+", "+e.top+") scale("+e.adjustedScale+")",opacity:e.opacity,"z-index":e.z}).attr("current-scale",e.adjustedScale);return $.roundabout_isInFocus(c,b.data("roundabout").degrees)}});