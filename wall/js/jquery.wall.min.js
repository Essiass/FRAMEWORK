/*!
	// Fluid _Interface -  http://www.b2bweb/wall/
	// Copyleft Molokoloco 2010
	// Version 1.0

	// Original JS http://www.b2bweb/wall/js/jquery.wall.js
	// The sources here : http://www.b2bweb.fr/wp-content/uploads/wall-by-molokoloco.zip
*/

var db=function(){"console"in window&&console.log.call(console,arguments)};dump=function(){"console"in window&&console.table.call(console,arguments)};var escapeURI=function(a){return encodeURIComponent?encodeURIComponent(a):encodeURI?encodeURI(a):escape?escape(a):a}; (function(a){a.easing.jswing=a.easing.swing;a.extend(a.easing,{def:"easeOutQuad",swing:function(c,f,j,g,n){return a.easing[a.easing.def](c,f,j,g,n)},easeInQuad:function(c,f,j,g,n){return g*(f/=n)*f+j},easeOutQuad:function(c,f,j,g,n){return-g*(f/=n)*(f-2)+j},easeInOutQuad:function(c,f,j,g,n){if((f/=n/2)<1)return g/2*f*f+j;return-g/2*(--f*(f-2)-1)+j}});a.fn.extend({wallify:function(c){var f=a(this);c=a.extend({defaultFeed:"http://feeds.feedburner.com/b2bweb",inputFeed:"input#url",divLoading:"div#loading", baseAppUrl:"",provider:"./feed2json.php",colorArr:a.xcolor&&a.xcolor.monochromatic("#0099CC")||["#0099CC","#0099BB"],colWidth:122,currentPage:1,boxWidth:f.width(),boxHeight:f.height(),W:a(window).width(),H:a(window).height(),dW:a(document).width(),dH:a(document).height()},c||{});var j=false,g=null,n=null,t=false,D=0,u={},q=0,s=0,r=function(){var b=a(c.inputFeed).val();if(!b||!/^https?:\/\/[A-Za-z0-9\-_%&\?\/.=:+ ]{5,}$/.test(b))b=c.defaultFeed;return b},J=function(b){if(a.browser.msie){var e=new ActiveXObject("Microsoft.XMLDOM"); e.loadXML(b);b=e}b=a(b).find("body > outline > outline");e=Math.floor(Math.random()*(b.length-1));e=b.eq(e).attr("xmlUrl");a(c.inputFeed).val(e);c.currentPage=1;v()},K=function(){a.ajax({dataType:a.browser.msie?"text":"xml",cache:true,processData:true,url:"./data/google-reader-subscriptions.xml",success:J,error:function(b,e,d){w("OPML loading error :( "+b+", "+e+", "+d+"):",6E3)}})},v=function(){t=true;n=a.ajax({dataType:"json",timeout:6E4,data:{url:r(),page:c.currentPage},url:c.provider,success:E, error:function(b,e,d){y();w("Feed loading error :( "+b+", "+e+", "+d+"):",6E3)}})},y=function(){a(window).unbind("scroll",F);a("a#up").stop().fadeIn(600);if(g){clearInterval(g);g=null}n.abort();j=t=false},A=function(){c.boxWidth=f.width();c.boxHeight=f.height();c.W=a(window).width();c.H=a(window).height();c.dW=a(document).width();c.dH=a(document).height()},G=function(){A();f.css({left:(c.boxWidth-Math.floor(c.W/c.colWidth)*c.colWidth)/2+"px"})},w=function(b,e){e=e||5E3;a(c.divLoading).stop().fadeOut(150); a("<div />").addClass("popup").css({opacity:0.96,top:a(window).scrollTop()+100}).html("<h1>Message...</h1><p>"+b+"</p>").appendTo("body").hide().fadeIn(200).delay(e).fadeOut(400,function(){a(this).remove()})},B=false,F=function(){B=true};setInterval(function(){if(B){B=false;var b=a(window).scrollTop();if(b>2&&!a("a#up").is(":visible"))a("a#up").stop().fadeIn(600);else b<=2&&a("a#up").is(":visible")&&a("a#up").stop().fadeOut(600);t||g||a(document).height()-a(window).height()-a(window).scrollTop()< 30&&v()}},250);var H=function(){var b=a(this),e=b.find("div.imgLeg");e.stop().animate({bottom:"-"+(e.outerHeight()+2)+"px",backgroundPosition:"-550px 0"},250);a("html, body").stop();var d=b.offset().top,i=Math.max(b.height(),240),l=a(window).scrollTop(),k=null;if(d<l+80)k=d-80;else if(d+i>l+c.H-80)k=d-c.H+i+80;if(k!=null&&k!=l)a("html, body").animate({scrollTop:k},l-k>60||k-l>60?"1400":"800");d=setTimeout(function(o){o=a(o);var h=o.offset(),m=parseInt(h.top);h=parseInt(h.left);var p=o.width(),x=o.height(), z=Math.max(x,240),C={opacity:0.96,top:m-10+"px",width:p+300+30+"px",height:z+20+"px"};h<c.W/2?a.extend(C,{left:h-10+"px"}):a.extend(C,{left:h-300-20+"px"});var L=a("<div />").addClass("voilage").css({opacity:0,width:c.dW+"px",height:c.dH+"px"}).appendTo("body").animate({opacity:0.8},{duration:600});z=a("<div />").addClass("popupIntro").css({opacity:0,top:m+"px",left:h+"px",width:p+"px",height:x+"px"}).html('<div style="width:310px;height:'+z+"px;float:"+(h<c.W/2?"right":"left")+'"><h2>'+e.text()+ "</h2><p>"+o.data("introduction")+"</p></div>").appendTo("body").animate(C,{duration:333});o.css("zIndex","900");o.data({t:m,l:h,w:p,h:x,divVoile:L,divPop:z})},1200,this);b.data({mouser:d})},I=function(){var b=a(this),e=b.data("mouser"),d=b.data("divPop"),i=b.data("divVoile"),l=b.find("div.imgLeg");if(e){clearTimeout(e);b.data({mouser:null})}d&&d.length>0&&d.stop().animate({opacity:0,top:b.data("t")+"px",left:b.data("l")+"px",width:b.data("w")+"px",height:b.data("h")+"px"},{duration:300,complete:function(){d.remove(); b.css("zIndex","500")}});i&&i.length>0&&i.stop().animate({opacity:0},{duration:333,complete:function(){i.remove();b.css("zIndex","500")}});l.stop().show();l.animate({bottom:"0"},250);l.animate({backgroundPosition:"0px 0px",opacity:1},500)},M=function(){if(q>0){s=Math.max(q,s);if(s>1){var b=parseInt((s-q)/s*100);a("span#scrollInfos").html("Loading images <strong>"+b+"%</strong>")}}else{s=0;if(g){clearInterval(g);g=null}a("span#scrollInfos").html("Scroll down to load more items... (<strong>P"+c.currentPage+ "</strong>)");if(j){for(b in u)f.masonry({appendedContent:u[b]});u=[];A()}else{j=true;a(c.divLoading).fadeOut(1600);f.masonry({columnWidth:c.colWidth,itemSelector:"div.box",animate:true,animationOptions:{duration:800}},function(){setTimeout(function(){G();a(window).bind("smartresize",G);a(window).bind("scroll",F);A();f.height()+300<c.dH&&setTimeout(function(){v()},5E3);f.masonry({animate:false})},1200)})}}},E=function(b){t=false;q=0;if(!b||b[0]&&b[0].message){y();if(!b||!b[0]||!b[0].message)w("Can't find PHP feed fetcher...", 5E3);else b[0].message=="no more"?a("span#scrollInfos").html('No more data... we fetch a new one ! (Or <a href="javascript:void(0);" onclick="$(\'html, body\').animate({scrollTop:0}, 1600);">Try a new feed</a> !)'):w(b[0].message,1E4);setTimeout(function(){K()},5E3)}else{a.each(b,function(e,d){D++;var i=c.colorArr[Math.round(Math.random()*(c.colorArr.length-1))],l=d.title.length,k="box_"+D,o="";o=c.W>480?"col"+(l<50?"1":l<100?"2":"3"):"col"+(l<80?"1":"2");if(e==0&&c.currentPage==1){i="#0099CC";$box= a('<div id="'+k+'" class="box col3 shadow titleBox"><h1 style="color:'+i+';">'+d.title+'</h1><p style="color:'+i+';"><strong>'+d.description+'</strong></p><p style="color:'+i+';"><strong>Site :</strong> <a href="'+d.link+'" target="_blank">'+unescape(d.link)+'</a><br /><strong>Feed :</strong> <a href="'+r()+'" target="_blank">'+unescape(r())+"</a><br />&nbsp;</p></div>")}else if(e==0&&c.currentPage>1)return true;else $box=a('<div id="'+k+'" class="box '+o+' shadow" onclick="window.open(\''+d.permalink+ '\');"><h3 style="color:'+i+';">'+d.title+"</h3></div>");$box.data({introduction:d.introduction,url:d.permalink});f.append($box);$box.css("opacity",0).delay(1E3+e*250).animate({opacity:1},800,"easeOutQuad");if(e!=0||c.currentPage>1)$box.bind({mouseenter:H,mouseleave:I});if(j)u[k]=$box;if(d.enclosure){q++;a("<img />").load(function(){var h=a(this),m=h.width(),p=h.height();h.remove();if(m>50&&p>50){h="col1";h=c.W>480?"col"+(m<100?"1":m<300||p>300?"2":"3"):"col"+(m<200?"1":"2");$imgBox=a('<div id="'+ k+'" class="box '+h+' withImg" onclick="window.open(\''+d.permalink+'\');" style="width:'+m+"px; height:"+p+'px;"><div style="background:url('+d.enclosure+") no-repeat center center;width:"+m+"px; height:"+p+'px;">&nbsp;</div><div class="imgLeg"><p>'+d.title+"</p></div></div>");a("div#"+k).replaceWith($imgBox).hide();$leg=$imgBox.find("div.imgLeg");$leg.css({bottom:"-"+($leg.outerHeight()+2)+"px"});if(j)u[k]=$imgBox;$imgBox.data({introduction:d.introduction,url:d.permalink});$imgBox.bind({mouseenter:H, mouseleave:I});$imgBox.find("div:first").css({marginTop:p/2,marginLeft:m/2,width:0,height:0}).delay(600+e*200).show().animate({marginTop:0,marginLeft:0,width:m,height:p},800,"easeOutQuad",function(){a(this).parent("div.box").addClass("shadow");setTimeout(function(x){x.trigger("mouseleave")},600+e*200,a(this))})}q--}).error(function(){a(this).remove();q--;db("Img error : "+d.enclosure)}).attr("src",d.enclosure).css("marginLeft","100%").appendTo(f)}});c.currentPage++;g=setInterval(M,25)}};v=function(){t= true;var b=r();a("span#scrollInfos").html("Loading data... "+unescape(b)+(c.currentPage>1?" (<strong>P"+c.currentPage+"</strong>)":""));n=a.ajax({dataType:"json",timeout:6E4,cache:true,data:{url:b,page:c.currentPage},url:c.provider,success:E,error:function(e,d,i){y();w("Feed loading error "+b+" :( "+e+", "+d+", "+i+"):",6E3)}})};a(c.divLoading).length<1&&a('<div id="loading"><img src="'+c.baseAppUrl+'img/loading.gif" width="31" height="31" alt="loading" /><br /><div id="message"></div><p>Parsing feed... <a href="'+ r()+'" target="_blank"><strong>'+unescape(r())+"</strong></a><br />Fetching items real URL, finding and resizing images...</p><br /><p><strong>Waiting !</strong>... But only the first time ^^</p></div>").appendTo("body");v();(function(){a(c.inputFeed).mouseenter(function(){if(!a(this).val()||a(this).val()==c.defaultFeed)a(this).val("http://");a(this).select()}).mouseleave(function(){if(!a(this).val()||a(this).val()=="http://")a(this).val(c.defaultFeed);a(this).blur()});a("form#formFeed").bind("submit", function(b){b.preventDefault();b=a(c.inputFeed).val();if(b==r()){y();document.location=c.baseAppUrl+"?url="+encodeURIComponent(b)}else{a(c.inputFeed).focus();a(c.inputFeed).select()}})})();return f}})})(jQuery);$(document).ready(function(){$("div#masonry").wallify();$("html, body").css({scrollTop:0})});$(window).bind("load",function(){$("html, body").css({scrollTop:0})});