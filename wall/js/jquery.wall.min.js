/*!
	// Fluid _Interface -  http://www.b2bweb/wall/
	// Copyleft Molokoloco 2010
	// Version 1.0

	// Original JS http://www.b2bweb/wall/js/jquery.wall.js
	// The sources here : http://www.b2bweb.fr/wp-content/uploads/wall-by-molokoloco.zip
*/

(function(a){var d=a("div#masonry"),q=a.xcolor.monochromatic("#0099CC"),r=1,k=d.width(),s=d.height(),h=false,l=false,t=0,i=null,e={},f=0,z=function(){var b={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(j,c,m){b[c]=m});return b},u=function(){var b=Math.floor(a("div.ui-body").width()/122)*122;b=(a("div.ui-body").width()-b)/2;d.css({left:b+"px"});k=a(window).width();s=a(window).height()},n=function(){l=true;a.ajax({dataType:"json",timeout:6E4,cache:false,data:{feed:z().feed||a("input#feed").val(), page:r},url:"./get_json_feed.php",error:function(b,j,c){alert("JSON error :( "+b+", "+j+", "+c)},success:A})},v=function(){l||typeof i=="number"||a(document).height()-a(window).height()-a(window).scrollTop()<30&&n()},B=function(){$leg=a(this).find("div.imgLeg");$leg.stop(true).css({bottom:"-"+($leg.outerHeight()+2)+"px",backgroundPosition:"-550px 0",opacity:0.3}).show();$leg.animate({bottom:"0"},250);$leg.animate({backgroundPosition:"0px 0",opacity:1},500)},C=function(){$leg=a(this).find("div.imgLeg"); $leg.stop(true).animate({bottom:"-"+($leg.outerHeight()+2)+"px",backgroundPosition:"-550px 0"},250)},D=function(){if(!(f>0)){clearInterval(i);i=null;if(h){for(var b in e)d.masonry({appendedContent:e[b]});e=[]}else{a("div#loading").fadeOut("slow");d.masonry({columnWidth:122,itemSelector:"div.box",animate:true});h=true;a(window).bind("smartresize",u);u();a(window).scroll(v);s>600&&n()}}},A=function(b){l=false;r++;f=0;if(!b||b[0]&&b[0].message){a(window).unbind("scroll",v);d.after('<p class="right">'+ (b[0].message||"You reach the end of the net.. no more data...")+"</p>")}else{a.each(b,function(j,c){if(j!=0){t++;var m=q[Math.round(Math.random()*(q.length-1))],o=c.title.length,g="box_"+t,w="col1";w=k>500?"col"+(o<50?"1":o<100?"2":"3"):"col"+(o<80?"1":"2");$box=a('<div id="'+g+'" class="box '+w+'" data-theme="c" onclick="window.open(\''+c.permalink+'\');"><h3 style="color:'+m+';">'+c.title+"</h3></div>");d.append($box);if(h)e[g]=$box;if(c.enclosure){f++;a("<img />").load(function(){var p=a(this).width(), x=a(this).height();if(p>50&&x>50){var y="col1";y=k>500?"col"+(p<100?"1":x>300?"2":"3"):"col"+(p<200?"1":"2");$imgBox=a('<div id="'+g+'" class="box '+y+' withImg" data-theme="c" onclick="window.open(\''+c.permalink+'\');"><img src="'+c.enclosure+'" alt="'+c.title+'"/><div class="imgLeg"><p>'+c.title+"</p></div></div>");a("div#"+g).replaceWith($imgBox);if(h)e[g]=$imgBox;$imgBox.bind({mouseenter:B,mouseleave:C})}a(this).remove();f--}).error(function(){a(this).remove();f--}).attr("src",c.enclosure).appendTo("body")}}}); i=setInterval(D,100)}};a(document).ready(function(){window.scrollTo(0,1);a("div#loading").fadeIn("slow");n();a("input#feed").data("valInit",a("input#feed").val()).focus(function(){a(this).val()==a(this).data("valInit")&&a(this).val("http://").select()}).blur(function(){if(a(this).val()==""||a(this).val()=="http://")a(this).val(a(this).data("valInit"))});a("form#formFeed #submit").click(function(b){b.preventDefault();a("input#feed").val()?a("form#feedValidate").submit():a("input#feed").focus()})})})(jQuery);