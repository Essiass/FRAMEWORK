// jQuery scrollView V0.8.4 : Viewport scroll and screen vertical helper - @molokoloco 2013 - Copyleft
// One view for each screen that user need to scroll to get to the bottom of the HTML view
// Live fiddle : http://jsfiddle.net/molokoloco/XK3t5/
// Github : https://github.com/molokoloco/FRAMEWORK/blob/master/jquery.plugins/jquery.scrollScreen.js
//          https://github.com/molokoloco/FRAMEWORK/blob/master/jquery.plugins/jquery.scrollScreen.css
// Infos : http://www.b2bweb.fr/molokoloco/jquery-scrollview-viewport-scroll-and-screen-vertical-helper

(function(a,p,x){var q=a(p),r=a(x),A=a("body"),m="html,body,document",n=a(),s="",y=!1;a(m).each(function(){var b=parseInt(a(this).scrollTop(),10);a(this).scrollTop(b+1);if(q.scrollTop()==b+1)return m=this.nodeName.toLowerCase(),!1});var n=a(m),j=function(){return p.location.hash||""},t=function(){return parseInt(n.scrollTop()||q.scrollTop(),10)},u=function(b){y=!0;var a=360+0.42*Math.abs(b-t());2222<a&&(a=0);n.stop(!0,!1).animate({scrollTop:b},{duration:a,easing:"easeOutCubic",complete:function(){var b=
s;b&&j()!=b&&(p.location.hash=b);s="";y=!1}})};a.easing.jswing=a.easing.swing;a.extend(a.easing,{def:"easeOutQuad",swing:function(b,k,d,h,e){return a.easing[a.easing.def](b,k,d,h,e)},easeInQuad:function(b,a,d,h,e){return h*(a/=e)*a+d},easeOutCubic:function(b,a,d,h,e){return h*((a=a/e-1)*a*a+1)+d}});a.fn.scrollToMe=function(b){return this.each(function(){b&&(s=b);u(parseInt(a(this).offset().top,10))})};a.fn.scrollScreen=function(b){if(!0==A.data("scrollScreen"))return this;A.data("scrollScreen",!0);
b=a.extend(!0,{},a.fn.scrollScreen.defaults,"object"==typeof b&&b);var k=a(this),d=a('<div class="'+b.scrollScreen+'">1</div>').appendTo(k),h=a('<div class="'+b.scrollScreenZone+'" title="Pour naviguer d\'\u00e9cran en \u00e9cran..."></div>').appendTo(k),e=null,g=null,f=q.height(),l=r.height(),m=f*(f/l),v=1+Math.floor(r.height()/f),n=-Math.floor(d.height()-d.height()/3),s=f-d.height(),B=function(){d.css({left:r.width()-d.width()-3})},C=function(){b.debug&&console.log("mouseIsMoveViewsClear()");e&&
clearTimeout(z);y?e=setTimeout(C,2500):(e=null,d.removeClass("current"),h.attr("title",""),w(t()))},D=function(c){b.debug&&console.log("moveViews(ascPos)",c);c=c||t();c+=n;c=Math.max(c,0);c=Math.min(c,s);var a=1+Math.floor(v*(c/f));d.css({top:c}).text(a);if(b.checkHash&&j()!="#screen_"+a&&(c="#screen_"+a)&&j()!=c)p.location.hash=c},z=function(c){b.debug&&console.log("mouseIsMoveViews(event)",c.clientY);e?(clearTimeout(e),e=null):d.addClass("current");D(c.clientY)},w=function(c){b.debug&&console.log("setCurrentViewport(scrollTop)",
c);c=((c||t())+f)/l;D((f-m)*c)},k=function(c){b.debug&&console.log("viewportClick(event)",c);var a=0,a=10>c.clientY?0:c.clientY>f-10?l:l*((c.clientY+n)/f);u(a);return!1};B();b.debug&&console.log("createViewport()");h.on("click touchend",k).on("dblclick",function(){b.debug&&console.log("viewportDbClick()");u(1);return!1}).on("mousemove",z).on("mouseout",function(a){b.debug&&console.log("mouseIsOutViews(event)",a);e&&clearTimeout(z);e=setTimeout(C,2500)});d.on("click touchend",k);w();var x=function(){b.debug&&
console.log("scrollRefreshEvent()");g=null;d.removeClass("current")},F=function(a){b.debug&&console.log("resizeRefreshEvent()");f=q.height();l=r.height();m=f*(f/l);v=Math.ceil(r.height()/f);1>=v?d.hide():d.show();B();w();b.checkHash&&(g=setTimeout(function(a){g=null;E(a)},1E3,a||j()))};q.on("scroll",function(){g&&clearTimeout(g);g=setTimeout(x,600);w();d.addClass("current")}).on("resize",function(){g&&clearTimeout(g);g=setTimeout(F,360,j())});F();var E=function(a){b.debug&&console.log("checkHash(hash)",
a,"getHash()",j());if(a=a||j())if(a=a.split("screen_"),1<parseInt(a[1],10)){a=a[1];b.debug&&console.log("moveToViewport(view)",a);var d=0,d=a==v?l:a*f;u(d)}};b.checkHash&&E();return this};a.fn.scrollScreen.defaults={debug:"console"in p&&!1,checkHash:!1,scrollScreenZone:"scrollScreenZone",scrollScreen:"scrollScreen"}})(jQuery,window,document);
