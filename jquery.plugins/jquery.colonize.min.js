// Molokoloco 2013 - Copyleft
// Live fiddle : http://jsfiddle.net/molokoloco/Ra288/
// Github : https://github.com/molokoloco/FRAMEWORK/blob/master/jquery.plugins/jquery.colonize.js
// infos : http://www.b2bweb.fr/molokoloco/jquery-colonize-plugin-in-between-titles-multicols-paragraphes-with-css3/

(function(c){c.fn.colonize=function(a){a=c.extend(!0,{},c.fn.colonize.defaults,"object"==typeof a&&a);var d=null,p='<div class="'+a.css+'"/>',e=0,h=0,k=0,l=0,m=0,n=function(){for(var f=c(this),b=f.next(),g=[],d=!1,e=0;b;)b.is(a.take)?(g.push(b),b=b.next()):(b.is(a.chapters)||(d=!0),b=null);if(1<g.length||g.length&&g[0].outerHeight()>m){for(var b=c(p),j=0,h=g.length;j<h;j++)e+=g[j].height()*k,b.append(g[j].detach()),e>=a.maxHeight&&(b.insertAfter(f),f=b,e=0,b=c(p));b.insertAfter(f);d&&c.proxy(n,b.next())()}else d&&
(l++,3>l&&f.next()&&c.proxy(n,f.next())())};return this.each(function(){d=c(this);h=e=d.width();k=1;m=l=0;d.find(a.css).remove();var f=c("<p>A</p>").appendTo(d);m=f.outerHeight();f.remove();a.colWidth&&(a.colCount=Math.max(1,Math.floor(e/a.colWidth)));h=(e-2*a.marge*a.colCount)/a.colCount;k=e/h;d.find(a.chapters).each(n)})};c.fn.colonize.defaults={marge:10,colWidth:null,colCount:null,chapters:"h1,h2,h3,h4,h5,h6",take:"p",css:"multiplecolumns",maxHeight:Math.max(100,c(window).height()-60)}})(window.jQuery);
